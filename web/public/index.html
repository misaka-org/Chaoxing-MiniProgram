<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="never">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>å­¦ä¹ é€šç­¾åˆ° Â· å¾¡å‚ç½‘ç»œ Misaka</title>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f5f5f5;
        }

        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            margin-top: 20vh;
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
        }

        .login-container h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .login-container input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .login-container button {
            width: 100%;
            padding: 10px;
            background-color: #0052d9;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
        }

        .login-container button:hover {
            background-color: #0049c0;
        }

        .error {
            color: red;
            text-align: center;
            margin-top: 10px;
        }

        @media (max-width: 600px) {
            .login-container {
                padding: 15px;
            }
        }

        .course-container {
            max-width: 800px;
            padding: 20px;
        }

        .course-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .course-item {
            display: flex;
            align-items: center;
            background-color: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s ease;
        }

        .course-item:hover {
            transform: translateY(-5px);
        }

        .course-item img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 20px;
        }

        .course-info {
            flex-grow: 1;
        }

        .course-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0 0 10px 0;
        }

        .course-info {
            font-size: 14px;
            color: #666;
        }

        @media (max-width: 600px) {
            .course-item {
                flex-direction: column;
                text-align: center;
            }

            .course-item img {
                margin-bottom: 10px;
            }

            .course-info {
                text-align: center;
            }
        }

        .link {
            text-decoration: none;
        }

        .center-notcie {
            text-align: center;
            line-height: 30px;
            font-size: 14px;
            color: gray;
            font-weight: 600;
        }

        #gf {
            cursor: pointer;
            text-decoration: underline;
        }

        .qrcode {
            width: 200px;
            height: 200px;
            margin: 0 calc(50% - 100px);
        }
    </style>
</head>

<body>
    <div class="login-container">
        <h1>XXTç™»å½•</h1>

        <img class="qrcode" src="qrcode.png" alt="å°ç¨‹åºç ">

        <div class="center-notcie">å¦‚æœ‰ä¾µæƒï¼Œè¯·å‘é‚®ä»¶è‡³ admin@micono.eu.org</div>
        <div class="center-notcie">æœ¬ç½‘é¡µç”±å…¬ä¼—å·ã€å¾¡å‚ç½‘ç»œ Misakaã€‘å…è´¹æä¾›ï¼</div>
        <div class="center-notcie" id="gf"> > å®˜æ–¹ç½‘é¡µç‰ˆï¼ˆæ‰¾å›å¯†ç ï¼‰ < </div>

                <input type="text" id="username" placeholder="è¯·è¾“å…¥è´¦å·ï¼ˆæ‰‹æœºå·ï¼‰" />
                <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆé¿å…ç‰¹æ®Šç¬¦å·ï¼‰" />
                <button onclick="login()" id="login">ç™»å½•</button>
                <div id="errorMessage" class="error"></div>
        </div>

        <div class="course-container" hidden>
            <h1>è¯¾ç¨‹åˆ—è¡¨</h1>
            <button onclick="getCourses()" id="get_courses">è·å–è¯¾ç¨‹</button>
            <div class="course-list" id="courseList"></div>

            <template id="courseTemplate">
                <div class="course-item">
                    <a class="link" href="">
                        <div class="course-title"></div>
                        <div class="course-info"></div>
                    </a>
                </div>
            </template>
        </div>

        <script type="module">
            import API from "./utils/api.js?v=2";

            let api = null;

            window.getCourses = () => {
                document.getElementById("courseList").textContent = "";
                document.getElementById("get_courses").hidden = true;
                api.getCourses().then((list) => {
                    const courseList = document.getElementById("courseList");
                    const template = document.getElementById("courseTemplate").content;

                    const clone = document.importNode(template, true);
                    clone.querySelector(".course-title").textContent = "ğŸ‰ğŸ‰ å°ç¨‹åº";
                    clone.querySelector(
                        ".course-info"
                    ).textContent = `ç‚¹å‡»è“å­—è¿›å…¥å°ç¨‹åºï¼Œè½¬å‘ç»™å¥½å‹ä»¥ä¾¿ä¸‹æ¬¡ä½¿ç”¨~`;
                    clone.querySelector(".link").href = api.getMiniProgram();
                    courseList.appendChild(clone);

                    list.forEach(async (course) => {
                        const clone = document.importNode(template, true);
                        clone.querySelector(".course-title").textContent =
                            course.courseName;
                        clone.querySelector(
                            ".course-info"
                        ).textContent = `æ•™å¸ˆ:${course.teacherName} Â· ç­çº§:${course.className}`;
                        clone.querySelector(".link").href = api.getWechatUrl(
                            course.courseId,
                            course.classId
                        );
                        courseList.appendChild(clone);
                    });
                });
            };

            window.login = () => {
                const username = document.getElementById("username").value;
                const password = document.getElementById("password").value;
                const errorMessage = document.getElementById("errorMessage");
                errorMessage.textContent = ""; // æ¸…ç©ºä¹‹å‰çš„é”™è¯¯ä¿¡æ¯
                document.getElementById("login").disabled = true;

                if (!username || !password) {
                    errorMessage.textContent = "è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ";
                    return;
                }

                api = new API(username, password);
                api
                    .login()
                    .then((res) => {
                        if (res.status) {
                            document.querySelector(".login-container").hidden = true;
                            document.querySelector(".course-container").hidden = false;
                            getCourses();
                        } else {
                            errorMessage.textContent = res.mes;
                        }
                    })
                    .catch((err) => {
                        errorMessage.textContent = "ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•";
                        console.error(err);
                    })
                    .finally(() => {
                        document.getElementById("login").disabled = false;
                    });
            };

            window.onload = () => {
                document.getElementById("gf").onclick = () => {
                    window.open(
                        "https://passport2.chaoxing.com/login?refer=https%3A%2F%2Fmooc1.chaoxing.com%2Fcourse%2Fphone%2Fcourselisthead%3Fpassed%3D1&fid=0&newversion=true&_blank=0"
                    );
                };
            };
        </script>
</body>

</html>